阶段 1: agent.invoke()
│
├─ input_data: {"messages": [...]}
├─ config: {"configurable": {"thread_id": "..."}}
└─ options: {...}

阶段 2: beforeAgent Hook
│
├─ state: CustomAgentState
├─ runtime: Runtime (完整运行时)
└─ input_data: 原始输入

阶段 3: beforeModel Hook  
│
├─ ModelRequest: {"messages": [...], "model": "..."}
├─ runtime: Runtime
└─ state: 当前状态

阶段 4: LLM 调用
│
└─ ModelRequest (实际发送给 LLM)

阶段 5: Tool 调用 ← 你最关心！
│
├─ ToolRuntime[StateSchema, ContextSchema]
│   ├── runtime.state: CustomAgentState
│   ├── runtime.context: Context  
│   ├── runtime.store: BaseStore
│   ├── runtime.checkpointer: Checkpointer
│   ├── runtime.tools: List[Tool]
│   └── runtime.config: Config
└─ tool_args: 用户传入参数

阶段 6: afterModel Hook
│
├─ state: 更新后的状态
├─ runtime: Runtime
└─ AIMessage: 模型返回

阶段 7: afterAgent Hook
│
├─ state: 最终状态
├─ runtime: Runtime
└─ result: 完整结果